(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{238:function(e,t,a){},275:function(e,t,a){e.exports=a.p+"static/media/ico.f5c2ef23.png"},290:function(e,t,a){e.exports=a.p+"static/media/error-404.edab0e16.png"},295:function(e,t,a){e.exports=a(549)},333:function(e,t,a){},334:function(e,t,a){},359:function(e,t,a){},472:function(e,t,a){},543:function(e,t,a){},544:function(e,t,a){},549:function(e,t,a){"use strict";a.r(t);a(296),a(297),a(298),a(328);var n=a(0),s=a.n(n),i=a(25),l=a.n(i),r=(a(333),a(18)),o=a(19),c=a(22),m=a(20),d=a(21),h=(a(334),a(49),a(10)),p=a(23),u=a(281),f=a.n(u),g=a(558),A=a(277),E=a(557),b=a(278),y=a(279),v=a(556),w={SUCCESS:"ALERT_SUCCESS",ERROR:"ALERT_ERROR",CLEAR:"ALERT_CLEAR"},S={REGISTER_REQUEST:"USER_REGISTER_REQUEST",REGISTER_SUCCESS:"USER_REGISTER_SUCCESS",REGISTER_FAILURE:"USER_REGISTER_FAILURE",LOGIN_REQUEST:"USER_LOGIN_REQUEST",LOGIN_SUCCESS:"USER_LOGIN_SUCCESS",LOGIN_FAILURE:"USER_LOGIN_FAILURE",LOGOUT:"USER_LOGOUT",RATED:"FILM_RATED",PLAYLIST_FILM_ACTION:"USER_PLAYLIST_FILM_ACTION"},C={success:function(e){return{type:w.SUCCESS,message:e}},error:function(e){return{type:w.ERROR,message:e}},clear:function(){return{type:w.CLEAR}}};var k={apiUrl:"https://my-film-app.herokuapp.com/api/",pathName:"/filmapp_frontend/"};function O(){var e=JSON.parse(localStorage.getItem("user"));return e&&e.token?{Authorization:"Bearer "+e.token}:{}}function I(e,t){return{Authorization:"Basic "+window.btoa(e+":"+t)}}var N=a(58),L=Object(N.a)(),D=a(64),j=a(272),x=a(273),R=JSON.parse(localStorage.getItem("user")),M=R?{loggedIn:!0,user:R}:{};var H=Object(D.combineReducers)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S.LOGIN_REQUEST:return{loggingIn:!0,user:t.user};case S.LOGIN_SUCCESS:return{loggedIn:!0,user:t.user};case S.LOGIN_FAILURE:case S.LOGOUT:return{};default:return e}},registration:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch((arguments.length>1?arguments[1]:void 0).type){case S.REGISTER_REQUEST:return{registering:!0};case S.REGISTER_SUCCESS:case S.REGISTER_FAILURE:return{};default:return e}},alert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w.SUCCESS:return{type:"alert-reducer",message:t.message};case w.ERROR:return{type:"alert-danger",message:t.message};case w.CLEAR:return{};default:return e}},rate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S.RATED:return{rated:t.meta};default:return e}},playlistFilm:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S.PLAYLIST_FILM_ACTION:return{playlistFilm:t.operation};default:return e}}}),U=(Object(x.createLogger)(),Object(D.createStore)(H,Object(D.applyMiddleware)(j.a))),T={login:function(e,t){var a={method:"POST",headers:I(e,t)};return fetch("".concat(k.apiUrl,"/users/auth"),a).then(F).then(function(e){return localStorage.setItem("user",JSON.stringify(e)),e})},logout:P,register:function(e){var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return fetch("".concat(k.apiUrl,"/users/"),t).then(F)}};function P(){localStorage.removeItem("user")}function F(e){return e.text().then(function(t){var a=t&&JSON.parse(t);if(!e.ok){401===e.status&&P();var n=a&&a.errors||e.statusText;return Promise.reject(n)}return a})}var Q={login:function(e,t){return function(a){var n;a((n={username:e},{type:S.LOGIN_REQUEST,user:n})),T.login(e,t).then(function(e){a(function(e){return{type:S.LOGIN_SUCCESS,user:e}}(e)),a(Q.rate("CHECK_RATE")),L.goBack()},function(e){a(function(e){return{type:S.LOGIN_FAILURE,error:e}}(e.toString())),a(C.error(e.toString()))})}},logout:function(){return T.logout(),{type:S.LOGOUT}},register:function(e){return function(t){t(function(e){return{type:S.REGISTER_REQUEST,user:e}}(e)),T.register(e).then(function(e){t(function(e){return{type:S.REGISTER_SUCCESS,user:e}}()),t(C.success("Registration successful")),L.goBack()},function(e){t(function(e){return{type:S.REGISTER_FAILURE,error:e}}(e.toString())),t(C.error(e.toString()))})}},rate:function(e){return function(t){t(function(e){return{type:S.RATED,meta:e}}(e))}},playlistFilm:function(e){return function(t){t(function(e){return{type:S.PLAYLIST_FILM_ACTION,operation:e}}(e))}}};var B=a(30),G=a(6),z=a.n(G),W=(a(359),a(167)),K=a.n(W),_=a(127),Y=a.n(_),J=a(275),V=a.n(J),q=k.pathName,Z=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).handleProfileMenuOpen=function(e){a.setState({anchorEl:e.currentTarget})},a.handleProfileMenuClose=function(){a.setState({anchorEl:null})},a.handleLogoutClick=function(){a.setState({anchorEl:null}),a.props.dispatch(Q.rate("")),a.props.dispatch(Q.logout())},a.handleProfileClick=function(){a.setState({anchorEl:null}),a.props.history.push("".concat(q,"profile"))},a.state={title:"",anchorEl:null},a.handleSearchSubmit=a.handleSearchSubmit.bind(Object(h.a)(Object(h.a)(a))),a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleSelect",value:function(e){"login"===e?this.props.loggedIn&&this.props.dispatch(Q.logout()):"add_film"===e?this.props.history.push("".concat(q,"add")):"playlists"===e&&this.props.history.push("".concat(q,"playlists"))}},{key:"handleChange",value:function(e){var t=e.target.value;this.setState({title:t})}},{key:"handleSearchSubmit",value:function(e){var t=this;e.preventDefault();var a=this.state.title;this.setState({title:""}),document.getElementById("search-form").reset(),z.a.get("".concat(k.apiUrl,"films/filter/title?search=").concat(a,"&p=1")).then(function(e){var n=e.data;0===n.length?t.props.history.push({pathname:"".concat(q,"search"),search:"?search=".concat(a),state:{films:n}}):1===n.length?t.props.history.push("".concat(q,"film/").concat(n[0]._id)):t.props.history.push({pathname:"".concat(q,"search"),search:"?search=".concat(a),state:{films:n}})}).catch(function(e){})}},{key:"render",value:function(){var e=this,t=this.props.loggedIn,a=this.state.anchorEl,n=Boolean(a),i=s.a.createElement(K.a,{anchorEl:a,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:n,onClose:this.handleProfileMenuClose},s.a.createElement(Y.a,{key:"placeholder",style:{display:"none"}}),s.a.createElement(Y.a,{onClick:this.handleProfileClick},"Profile"),s.a.createElement(Y.a,{onClick:this.handleLogoutClick},"Logout"));return s.a.createElement(g.a,{expand:"md",bg:"light",variant:"light",onSelect:function(t){return e.handleSelect(t)}},s.a.createElement(A.a,{xs:{span:6,order:1},sm:{span:2,order:1},md:{span:4,order:1}},s.a.createElement(g.a.Brand,{href:q},s.a.createElement(g.a.Brand,null,s.a.createElement("img",{alt:"",src:V.a,width:"30",height:"30"})),s.a.createElement("p",{className:"d-none d-md-inline"},"FilmApp"))),s.a.createElement(A.a,{xs:{span:12,order:12},sm:{span:8,order:2},md:{span:5,order:5}},s.a.createElement(E.a,{id:"search-form",onSubmit:this.handleSearchSubmit,inline:!0},s.a.createElement(b.a,{vaule:this.state.title,onChange:this.handleChange,type:"text",placeholder:"Search"}),s.a.createElement(y.a,{onClick:this.handleSearchSubmit,className:"d-none d-sm-inline ml-1",variant:"light"},s.a.createElement(p.a,{icon:"search"})))),s.a.createElement(A.a,{className:"text-right d-md-none",xs:{span:6,order:7},sm:{span:2,order:10}},s.a.createElement(g.a.Toggle,{"aria-controls":"responsive-navbar-nav",onToggle:this.handleToggle})),s.a.createElement(A.a,{xs:{span:12,order:12},sm:{span:12,order:12},md:{span:3,order:9}},s.a.createElement(g.a.Collapse,{className:"justify-content-end",id:"responsive-navbar-nav"},s.a.createElement(v.a,{activeKey:""},s.a.createElement(v.a.Link,{className:"pr-2 pl-2",eventKey:"playlists"},"Playlists"),s.a.createElement(v.a.Link,{className:"pr-2 pl-2",eventKey:"add_film"},"Add"),t?s.a.createElement(f.a,{onClick:this.handleProfileMenuOpen,className:"pr-2 pl-2 custom-avatar button-my"},JSON.parse(localStorage.getItem("user")).user.nick.toUpperCase().charAt(0)):s.a.createElement(v.a.Link,{onClick:function(){"/filmapp_frontend/"===e.props.location.pathname?e.props.history.push("".concat(q,"login")):e.props.history.push("".concat(e.props.location.pathname,"/login").concat(e.props.location.search))},className:"pr-2 pl-2",eventKey:"login"},"Login")))),i)}}]),t}(n.Component);var X=Object(B.b)(function(e){return{loggedIn:e.auth.loggedIn}})(Z),$=a(31),ee=a(551),te=a(552),ae=a(67),ne=a.n(ae),se=a(33),ie=a(129),le=a(454),re=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).handleClick=function(){var e={headers:O()},t=a.state.title,n={title:t,films:[a.props.filmID]};z.a.post("".concat(k.apiUrl,"playlists"),n,e).then(function(e){var n=a.props.filmTitle?a.props.filmTitle:"",s="Created playlist ".concat(t," and added film ").concat(n,"!");a.props.handlePlaylistOperation(s)}).catch(function(e){a.setState({error:!0,errorMessage:e.response.data.errors[0]})})},a.loadPlaylist=function(){var e={headers:O()};a.setState({isLoading:!0},function(){z.a.get("".concat(k.apiUrl,"users/me/playlists"),e).then(function(e){var t=e.data;t.forEach(function(e){e.films.indexOf(a.props.filmID)>-1?e.contains=!0:e.contains=!1}),a.setState({isLoading:!1,loaded:!0,playlists:t})}).catch(function(e){a.setState({error:e.message,isLoading:!1,loaded:!0})})})},a.state={show:!1,isLoading:!0,loaded:!1,playlists:[],values:[],title:"",error:!1,errorMessage:"",playlistID:null},a.menuRef=s.a.createRef(),a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleChange",value:function(e,t,a){var n=this,s=this.state.playlists;s[t].contains=!s[t].contains,this.setState({playlists:s});var i={headers:O()},l={films:[this.props.filmID]},r="";!1===s[t].contains?z.a.put("".concat(k.apiUrl,"playlists/").concat(a,"/films/delete/"),l,i).then(function(e){var t=n.props.filmTitle?n.props.filmTitle:"";r="Deleted film ".concat(t," from playlist!"),n.state.playlistID&&n.state.playlistID===a&&n.props.dispatch(Q.playlistFilm("DELETED")),n.props.handlePlaylistOperation(r)}).catch(function(e){console.log(e)}):z.a.put("".concat(k.apiUrl,"playlists/").concat(a,"/films/"),l,i).then(function(e){var t=n.props.filmTitle?n.props.filmTitle:"";r="Added film ".concat(t," to playlist!"),n.state.playlistID&&n.state.playlistID===a&&n.props.dispatch(Q.playlistFilm("ADDED")),n.props.handlePlaylistOperation(r)}).catch(function(e){console.log(e)})}},{key:"componentDidMount",value:function(){this.props.playlistID&&this.setState({playlistID:this.props.playlistID}),this.setState({show:!0}),this.loadPlaylist()}},{key:"componentDidUpdate",value:function(e,t,a){e.show!==this.props.show&&this.setState({show:this.props.show})}},{key:"handleClickOutside",value:function(){this.setState({show:!1}),this.props.handleClickOutside(this.props.index)}},{key:"render",value:function(){var e=this,t=this.props.index,a=this.props.parentName,n=window.innerWidth,i=window.innerHeight,l="down",r=240;if(this.menuRef&&this.menuRef.current){var o=i-(this.menuRef.current.getBoundingClientRect().top+this.menuRef.current.getBoundingClientRect().height),c=this.menuRef.current.getBoundingClientRect().top;o<r&&(o>c?r=o:(l="up",c<r&&(r=c)))}var m=!1;return"search"===a?m=!0:"home"===a&&(n>=992?t%6!==5&&t%6!==4||(m=!0):n>=768?t%4!==3&&t%4!==2||(m=!0):n>=576?t%3!==2&&t%3!==1||(m=!0):t%2===1&&(m=!0)),s.a.createElement(ie.a,{ref:this.menuRef,drop:l},this.state.loaded&&s.a.createElement(ie.a.Menu,{alignRight:m,style:{height:r+"px",width:"240px",overflowY:"scroll"},show:this.state.show},this.state.playlists.length>0&&s.a.createElement("p",{className:"dropdown-item-my pl-4 pr-4"},"Save to..."),this.state.playlists.length>0&&s.a.createElement(ie.a.Divider,null),this.state.playlists.map(function(t,a){return s.a.createElement(A.a,{xs:12,sm:12,key:t.id},s.a.createElement(ee.a,{className:"pl-4 pr-4"},s.a.createElement(A.a,{xs:12,sm:12,className:"p-0 mb-2"},s.a.createElement(E.a.Check,{onChange:function(n){return e.handleChange(n,a,t.id)},custom:!0,inline:!0,checked:t.contains,label:t.title,type:"checkbox",id:t.id}))))}),this.state.playlists.length>0&&s.a.createElement(ie.a.Divider,null),s.a.createElement("p",{className:"dropdown-item-my pl-4 pr-4"},"Create a new playlist"),s.a.createElement(b.a,{isInvalid:this.state.error,onChange:function(t){e.setState({error:!1,title:t.target.value})},className:"dropdown-item-my w-75 ml-auto mr-auto mb-2 mt-2",placeholder:"Enter playlist name..."}),s.a.createElement(E.a.Control.Feedback,{type:"invalid",className:"dropdown-item-my w-75 ml-auto mr-auto mb-2 mt-2"},"Title is required"),s.a.createElement(A.a,{className:"mb-1 text-right justify-content-end"},s.a.createElement(y.a,{onClick:this.handleClick},"Create"))))}}]),t}(n.Component);var oe=Object(se.a)(function(e){return{alert:e.alert}})(le(re)),ce=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).state={show:!1},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.setState({show:!0})}},{key:"componentDidUpdate",value:function(e,t,a){e.show!==this.props.show&&this.setState({show:this.props.show})}},{key:"render",value:function(){var e=this,t=this.props.index,a=this.props.show,n=this.props.loggedIn,i=this.props.parentName,l="home"!==i?"profile"!==i?2:12:8;return n?s.a.createElement(A.a,{id:"a-b-1",xs:l,sm:l,className:"p-0 text-center justify-content-center d-flex playlist-add-home"},s.a.createElement(A.a,{id:"a-b-2",xs:8,sm:8,className:"playlist-add-icon-holder p-0 text-center",onClick:function(){e.props.handleAddPlaylistButtonClick(t)}},s.a.createElement(p.a,{id:"a-b-3",style:{opacity:a?1:""},className:"playlist-add-icon",icon:"ellipsis-v"})),a&&s.a.createElement(oe,{parentName:this.props.parentName,filmID:this.props.filmID,filmTitle:this.props.filmTitle,show:a,index:t,playlistID:this.props.playlistID,handleClick:this.props.handleClick,handleClickOutside:this.props.handleClickOutside,handlePlaylistOperation:this.props.handlePlaylistOperation})):null}}]),t}(n.Component);var me=Object(se.a)(function(e){return{loggedIn:e.auth.loggedIn}})(ce),de=a(124),he=a.n(de),pe=a(44),ue=a.n(pe),fe=a(66),ge=k.pathName,Ae=z.a.CancelToken.source(),Ee=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).handleScroll=function(){if(a.state.addOpenedIndex>=0&&!fe.isMobile){var e=a.state.films;e[a.state.addOpenedIndex].add=!1,a.setState({films:e,addOpenedIndex:-1})}a.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}});var t=Object(h.a)(Object(h.a)(a)),n=t.loadData,s=t.state,i=s.error,l=s.isLoading,r=s.hasMore;i||l||!r||window.innerHeight+document.documentElement.scrollTop>=document.body.offsetHeight-150&&n()},a.handleResize=function(){a.setState({windowWidth:window.innerWidth})},a.handlePlaylistOperation=function(e){if(a.state.addOpenedIndex>=0){var t=a.state.films;t.forEach(function(e){e.add=!1}),a.setState({films:t,addOpenedIndex:-1})}a.setState({open:!0,note:e})},a.handleClickOutside=function(e){if(a.state.addOpenedIndex>=0){var t=a.state.films;t.forEach(function(e){e.add=!1}),a.setState({films:t,addOpenedIndex:e})}},a.handleCreatePlaylistClick=function(){a.setState({addOpenedIndex:-1})},a.handleAddPlaylistButtonClick=function(e){var t=a.state.films;t[e].add=!t[e].add,a.setState({films:t,addOpenedIndex:e})},a.handleClose=function(e,t){"clickaway"!==t&&a.setState({open:!1})},a.loadData=function(){a.setState({isLoading:!0},function(){z.a.get("".concat(k.apiUrl,"films"),{params:{start:a.state.films.length,limit:6}}).then(function(e){var t=e.data;t.forEach(function(e){e.add=!1,e.img="".concat(k.apiUrl,"films/").concat(e.id,"/thumbnail/").concat(e.thumbnail._id,"?width=preview")}),a.setState({hasMore:6===t.length,isLoading:!1,films:[].concat(Object($.a)(a.state.films),Object($.a)(t))})}).catch(function(e){a.setState({error:e.message,isLoading:!1})})})},a.setRedirect=function(e){a.props.history.push("".concat(ge,"film/")+e)},a.state={films:[],addOpenedIndex:-1,redirect:!1,clickedOutside:!1,error:!1,hasMore:!1,isLoading:!1,scroll:{},windowWidth:window.innerWidth,open:!1,note:""},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize);var t={headers:O()};localStorage.getItem("user")&&(Ae.cancel(),Ae=z.a.CancelToken.source(),z.a.get("".concat(k.apiUrl,"users/me"),{cancelToken:Ae.token,requestParams:t}).then(function(e){}).catch(function(t){e.props.dispatch(Q.logout())})),this.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}}),this.setState({isLoading:!0},function(){var t=3,a=e.state.windowWidth;a<=576?t=1.3:a>1920?t=6:a>1422&&(t=5),z.a.get("".concat(k.apiUrl,"films"),{params:{start:0,limit:Math.ceil(6*t)}}).then(function(a){var n=a.data;n.forEach(function(e){e.add=!1,e.img="".concat(k.apiUrl,"films/").concat(e.id,"/thumbnail/").concat(e.thumbnail._id,"?width=preview")}),e.setState({hasMore:n.length>=Math.ceil(6*t),films:n,isLoading:!1})})})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this,t=this.state.isLoading,a=this.state.scroll,n=this.state.films.map(function(e){return Object.assign({},e)}),i=0;return s.a.createElement(A.a,null,s.a.createElement(ee.a,{className:"mt-5"},n.map(function(t,a){var l=t.id;return s.a.createElement(A.a,{className:"mb-5 film-preview-holder",xs:6,sm:4,md:3,lg:2,key:t.id},s.a.createElement("div",{className:"embed-responsive embed-responsive-16by9 z-depth-1-half container"},s.a.createElement("img",{onLoad:function(){t.img==="".concat(k.apiUrl,"films/").concat(t.id,"/thumbnail/").concat(t.thumbnail._id,"?width=preview")&&(t.img="".concat(k.apiUrl,"films/").concat(t.id,"/thumbnail/").concat(t.thumbnail._id,"?width=small"),++i>=n.length&&e.setState({films:n}))},alt:"",className:"embed-responsive-item image",src:t.img,onClick:function(){return e.setRedirect(l)}}),s.a.createElement(p.a,{className:"middle",icon:"play",onClick:function(){return e.setRedirect(l)}})),s.a.createElement(ee.a,{className:"m-0"},s.a.createElement(A.a,{xs:10,sm:10,className:"p-0"},s.a.createElement(ue.a,{line:2,text:t.title,id:"s-c-2",className:"mb-1 mt-1 title "})),s.a.createElement(A.a,{xs:2,sm:2,className:"p-0",style:{position:"absolute",right:0}},s.a.createElement(me,{parentName:"home",filmID:t.id,show:t.add,index:a,handleAddPlaylistButtonClick:e.handleAddPlaylistButtonClick,handleClick:e.handleCreatePlaylistClick,handleClickOutside:e.handleClickOutside,handlePlaylistOperation:e.handlePlaylistOperation}))),s.a.createElement("p",{className:"mb-0 author-nick"},s.a.createElement("small",null,t.author_name)),s.a.createElement("p",{className:"mb-0 film-views"},s.a.createElement("small",null,t.views," views")))})),(0===a.scrollTop||a.offsetHeight<=a.innerHeight)&&this.state.hasMore&&s.a.createElement(A.a,{sm:12,className:"text-center"},s.a.createElement(ne.a,{className:"button-my",variant:"contained",disabled:t,onClick:t?null:this.loadData},t?"Loading\u2026":"Click to load")),s.a.createElement(A.a,{style:{height:40},sm:12,className:"text-center"},!(0===a.scrollTop||a.offsetHeight<=a.innerHeight)&&this.state.isLoading&&s.a.createElement(te.a,{animation:"border"})),s.a.createElement(he.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.state.open,autoHideDuration:3e3,onClose:this.handleClose,ContentProps:{"aria-describedby":"message-id"},message:s.a.createElement("span",{id:"message-id"},this.state.note)}))}}]),t}(n.Component);var be=Object(se.a)(function(e){return{loggedIn:e.auth.loggedIn}})(Ee),ye=a(37),ve=a(38),we=(a(238),a(116),a(75)),Se=a.n(we),Ce=z.a.CancelToken.source(),ke=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).loadFilms=function(){Ce.cancel(),Ce=z.a.CancelToken.source(),a.setState({isLoading:!0},function(){a.props.handleLoading(a.state),z.a.get("".concat(k.apiUrl,"films"),{cancelToken:Ce.token,params:{exclude:a.state.filmID,start:a.state.films.length,limit:8}}).then(function(e){var t=e.data,n=0===t.length&&a.state.films.length<20?a.state.films.length:20;t.forEach(function(e){e.add=!1}),a.setState({hasMore:a.state.films.length+t.length<n,isLoading:!1,films:[].concat(Object($.a)(a.state.films),Object($.a)(t)),isLoaded:!0},function(){a.props.handleLoading(a.state)})}).catch(function(e){a.setState({error:e.message,isLoading:!1,isLoaded:!0},function(){a.props.handleLoading(a.state)})})})},a.setRedirect=function(e,t){e&&e.target&&("s-c-1"===e.target.id||"s-c-2"===e.target.id||"s-c-3"===e.target.id||"s-c-4"===e.target.id||"path"===e.target.localName&&e.target.parentElement&&e.target.parentElement.parentElement&&"a-b-2"!==e.target.parentElement.parentElement.id)&&a.props.handleThumbnail(t)},a.handleScroll=function(){if(a.state.addOpenedIndex>=0&&!fe.isMobile){var e=a.state.films;e[a.state.addOpenedIndex].add=!1,a.setState({films:e,addOpenedIndex:-1})}},a.handleResize=function(){},a.handlePlaylistOperation=function(e){if(a.state.addOpenedIndex>=0){var t=a.state.films;t.forEach(function(e){e.add=!1}),a.setState({films:t,addOpenedIndex:-1})}a.setState({openSnackbar:!0,note:e})},a.handleClickOutside=function(e){if(a.state.addOpenedIndex>=0){var t=a.state.films;t.forEach(function(e){e.add=!1}),a.setState({films:t,addOpenedIndex:e})}},a.handleCreatePlaylistClick=function(){a.setState({addOpenedIndex:-1})},a.handleAddPlaylistButtonClick=function(e){var t=a.state.films;t[e].add=!t[e].add,a.setState({films:t,addOpenedIndex:e})},a.handleCloseSnackbar=function(e,t){"clickaway"!==t&&a.setState({openSnackbar:!1})},a.state={filmID:"",error:!1,hasMore:!0,isLoading:!1,isLoaded:!1,films:[],addOpenedIndex:-1,openSnackbar:!1,note:""},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)}},{key:"componentDidMount",value:function(){window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize),this.setState({filmID:this.props.filmID}),this.loadFilms()}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;e.isLoading!==this.props.isLoading&&this.props.isLoading&&!this.state.error&&!this.state.isLoading&&this.state.hasMore&&this.loadFilms(),e.filmID!==this.props.filmID&&(Ce.cancel(),Ce=z.a.CancelToken.source(),this.setState({isLoading:!0,isLoaded:!1,filmID:this.props.filmID,error:!1,hasMore:!0,films:[],addOpenedIndex:-1,openSnackbar:!1},function(){n.props.handleLoading(n.state),z.a.get("".concat(k.apiUrl,"films"),{cancelToken:Ce.token,params:{exclude:n.state.filmID,start:0,limit:8}}).then(function(e){var t=e.data;t.forEach(function(e){e.add=!1}),n.setState({isLoaded:!0,hasMore:t.length<20,isLoading:!1,films:t},function(){n.props.handleLoading(n.state)})}).catch(function(e){z.a.isCancel(e)?console.log("Request canceled",e.message):n.setState({error:e.message,isLoading:!1},function(){n.props.handleLoading(n.state)})})}))}},{key:"render",value:function(){var e=this;return s.a.createElement(A.a,{className:"p-0"},this.state.films.map(function(t,a){return s.a.createElement(A.a,{className:"film-preview-holder p-0 mb-4 container",onClick:function(a){return e.setRedirect(a,t.id)},key:t.id},s.a.createElement(ee.a,null,s.a.createElement(A.a,{xs:7,sm:7},s.a.createElement("div",{className:"embed-responsive embed-responsive-16by9 z-depth-1-half"},s.a.createElement("img",{alt:"",id:"s-c-1",className:"image embed-responsive-item",src:"".concat(k.apiUrl,"films/").concat(t.id,"/thumbnail/").concat(t.thumbnail._id,"?width=small")}),s.a.createElement(p.a,{className:"middle",icon:"play"}))),s.a.createElement(A.a,{xs:5,sm:5,className:"p-0 "},s.a.createElement(ee.a,{className:"m-0"},s.a.createElement(A.a,{xs:10,sm:10,className:"p-0"},s.a.createElement(ue.a,{line:2,text:t.title,id:"s-c-2",className:"mb-1 title font-weight-bold"})),s.a.createElement(me,{parentName:"search",filmID:t.id,show:t.add,index:a,playlistID:e.props.playlistID,handleAddPlaylistButtonClick:e.handleAddPlaylistButtonClick,handleClick:e.handleCreatePlaylistClick,handleClickOutside:e.handleClickOutside,handlePlaylistOperation:e.handlePlaylistOperation})),s.a.createElement("p",{id:"s-c-3",className:"mb-0 author-nick"},s.a.createElement("small",null,t.author_name)),s.a.createElement("p",{id:"s-c-4",className:"film-views"},s.a.createElement("small",null,t.views," views")))))}),s.a.createElement(A.a,{style:{height:40},sm:12,className:"mb-2 text-center"},this.state.isLoading&&this.state.hasMore&&s.a.createElement(te.a,{animation:"border"})),s.a.createElement(Se.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.state.openSnackbar,autoHideDuration:1500,onClose:this.handleCloseSnackbar,ContentProps:{"aria-describedby":"message-id"},message:s.a.createElement("span",{id:"message-id"},this.state.note)}))}}]),t}(n.Component);var Oe=Object(B.b)(function(e){return{loggedIn:e.auth.loggedIn,rated:e.rate.rated}})(ke),Ie=(a(472),a(473),a(284)),Ne=a.n(Ie),Le=k.pathName,De=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).setRedirect=function(e){a.props.history.push({pathname:"".concat(Le,"film/")+e,search:"?list=".concat(a.state.playlist.id)}),a.props.handleSubmit(e)},a.handleResize=function(){a.setState({playlistHeight:a.props.filmElement.clientHeight,playlistHeaderHeight:null!==a.playlistHeader&&null!==a.playlistHeader.current&&null!=a.playlistHeader.current.clientHeight?a.playlistHeader.current.clientHeight:a.state.playlistHeaderHeight})},a.loadFilm=function(){z.a.get("".concat(k.apiUrl,"playlists/").concat(a.props.id)).then(function(e){a.setState({playlist:e.data});var t=e.data.films,n=[];t.forEach(function(e,t){e===a.state.currentFilm&&a.setState({index:t+1}),n.push(z.a.get("".concat(k.apiUrl,"films/").concat(e,"/desc/no")).then(function(e){return e.data}).catch(function(e){a.setState({error:e.message})}))}),Promise.all(n).then(function(e){a.setState({films:e,playlistHeight:a.props.filmElement.clientHeight,isPlaylistLoaded:!0},function(){a.setState({playlistHeaderHeight:null!==a.playlistHeader&&null!==a.playlistHeader.current&&null!=a.playlistHeader.current.clientHeight?a.playlistHeader.current.clientHeight:a.state.playlistHeaderHeight})})})}).catch(function(e){console.log(e)})},a.checkOwnerOfPlaylist=function(e){if(localStorage.getItem("user")){var t={headers:O()};a.setState({isLoading:!0},function(){z.a.get("".concat(k.apiUrl,"users/me"),t).then(function(t){var n=t.data.playlists;n.indexOf(e)>-1&&a.setState({ownerOfPlaylist:!0}),a.setState({isLoading:!1,loaded:!0,playlists:n})}).catch(function(e){a.setState({error:e.message,isLoading:!1,loaded:!0})})})}},a.handleRemoveFromPlaylist=function(e){var t={headers:O()},n={films:[e]};z.a.put("".concat(k.apiUrl,"playlists/").concat(a.state.id,"/films/delete/"),n,t).then(function(e){a.setState({openSnackbar:!0,note:"Deleted from playlist!"}),a.props.dispatch(Q.playlistFilm("DELETED"))}).catch(function(e){console.log(e)})},a.handleRemovePlaylist=function(){var e={headers:O()};z.a.delete("".concat(k.apiUrl,"playlists/").concat(a.state.id),e).then(function(e){a.setState({openSnackbar:!0,note:"Playlist deleted!"}),a.props.handleDeletePlaylist()}).catch(function(e){console.log(e)})},a.handleCloseSnackbar=function(e,t){"clickaway"!==t&&a.setState({openSnackbar:!1})},a.playlistHeader=s.a.createRef(),a.state={currentFilm:null,id:null,error:!1,hasMore:!0,isLoading:!1,films:[],playlist:"",playlistHeight:300,playlistHeaderHeight:50,index:1,isPlaylistLoaded:!1,ownerOfPlaylist:!1,openSnackbar:!1,note:""},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.id?(window.addEventListener("resize",this.handleResize),this.setState({id:this.props.id,currentFilm:this.props.filmID},function(){e.checkOwnerOfPlaylist(e.state.id)}),this.loadFilm()):console.log("Error loading playlist...")}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;e.filmID!==this.props.filmID&&this.setState({currentFilm:this.props.filmID,index:this.state.films.findIndex(function(e){return null!==e&&void 0!==e&&e.id===n.props.filmID})+1}),""!==this.props.playlistFilm&&e.playlistFilm!==this.props.playlistFilm&&("ADDED"!==this.props.playlistFilm&&"DELETED"!==this.props.playlistFilm||this.loadFilm(),this.props.dispatch(Q.playlistFilm(""))),this.props.loggedIn!==e.loggedIn&&(this.props.loggedIn?this.checkOwnerOfPlaylist(this.state.id):this.setState({ownerOfPlaylist:!1}))}},{key:"render",value:function(){var e=this,t=this.props.windowWidth,a=t>768&&t<1024?1:2;return this.state.isPlaylistLoaded&&s.a.createElement(A.a,{className:"p-0  mt-4 mb-5"},s.a.createElement(A.a,{className:"pt-2 pb-2 playlist-header",sm:12,ref:this.playlistHeader},s.a.createElement(ee.a,{className:"m-0 p-0"},s.a.createElement(A.a,{className:"m-0 p-0",id:"playlist_remove_header",xs:10,sm:10},s.a.createElement("p",{className:"mb-1"},this.state.playlist.title),s.a.createElement("small",null,"Marcin"),s.a.createElement("small",{className:"playlist-index"},"- ",this.state.films.length>0?this.state.index:0,"/",this.state.films.length)),this.state.ownerOfPlaylist&&s.a.createElement(A.a,{id:"playlist_remove",xs:2,sm:2,className:"m-0 p-0 text-center justify-content-center d-flex align-items-center",onClick:function(){return e.handleRemovePlaylist()}},s.a.createElement(p.a,{id:"playlist_remove_film_icon",icon:"trash-alt"})))),s.a.createElement(A.a,{style:{height:this.state.playlistHeight-this.state.playlistHeaderHeight+"px"},className:"p-0 playlist-container",xs:12,sm:12},s.a.createElement(Ne.a,{onYReachEnd:function(){},onScrollY:function(){}},this.state.films.map(function(t,n){return null!==t&&void 0!==t?s.a.createElement(ee.a,{xs:12,sm:12,className:"m-0 p-0 playlist-remove-container",key:t.id},s.a.createElement(A.a,{xs:10,sm:10,className:n===e.state.films.length-1?"mt-3 mb-3":"mt-3",onClick:function(){return e.setRedirect(t.id)}},s.a.createElement(ee.a,null,s.a.createElement(A.a,{className:"text-center justify-content-center d-flex align-items-center p-0 pl-1",xs:1,sm:1},e.state.currentFilm===t.id&&e.state.index===n+1?s.a.createElement("small",null,s.a.createElement(p.a,{style:{fontWeight:300},icon:"play"})):s.a.createElement("small",null,n+1)),s.a.createElement(A.a,{className:"pr-2 pl-2",xs:6,sm:6},s.a.createElement("div",{className:"embed-responsive embed-responsive-16by9 z-depth-1-half"},s.a.createElement("img",{alt:"",className:"image embed-responsive-item",src:"".concat(k.apiUrl,"films/").concat(t.id,"/thumbnail/").concat(t.thumbnail._id,"?width=small")}),s.a.createElement(p.a,{className:"middle",icon:"play"}))),s.a.createElement(A.a,{xs:5,sm:5,className:"p-0"},s.a.createElement(ue.a,{line:a,text:t.title,className:"mb-0 title font-weight-bold"}),s.a.createElement("p",{className:"mb-1 author-nick"},s.a.createElement("small",null,t.author_name))))),e.state.ownerOfPlaylist&&s.a.createElement(A.a,{xs:2,sm:2,className:n===e.state.films.length-1?"playlist-remove-holder mt-3 mb-3 text-center justify-content-center d-flex align-items-center":"playlist-remove-holder mt-3 text-center justify-content-center d-flex align-items-center"},s.a.createElement(p.a,{onClick:function(){return e.handleRemoveFromPlaylist(t.id)},icon:"trash-alt"}))):s.a.createElement(ee.a,{xs:12,sm:12,className:"m-0 p-0 playlist-remove-container",key:n},s.a.createElement(A.a,{xs:10,sm:10,className:n===e.state.films.length-1?"mt-3 mb-3":"mt-3"},s.a.createElement(ee.a,null,s.a.createElement(A.a,{className:"text-center justify-content-center d-flex align-items-center p-0 pl-1",xs:1,sm:1},e.state.index===n+1?s.a.createElement("small",null,s.a.createElement(p.a,{style:{fontWeight:300},icon:"play"})):s.a.createElement("small",null,n+1)),s.a.createElement(A.a,{className:"pr-2 pl-2",xs:6,sm:6},s.a.createElement("div",{className:"embed-responsive embed-responsive-16by9 z-depth-1-half"},s.a.createElement("img",{alt:"",className:" embed-responsive-item",src:"https://www.atelierliving.nl/wp-content/themes/ctrln/assets/images/placeholder.png"}),s.a.createElement(p.a,{className:"middle",icon:"play"}))),s.a.createElement(A.a,{xs:5,sm:5,className:"p-0"},s.a.createElement("p",{className:"mb-0 title font-weight-bold mb-1 author-nick"},"[Film delted]")))),e.state.ownerOfPlaylist&&s.a.createElement(A.a,{xs:2,sm:2,className:n===e.state.films.length-1?"playlist-remove-holder mt-3 mb-3 text-center justify-content-center d-flex align-items-center":"playlist-remove-holder mt-3 text-center justify-content-center d-flex align-items-center"},s.a.createElement(p.a,{onClick:function(){return e.handleRemoveFromPlaylist(e.state.playlist.films[n])},icon:"trash-alt"})))}))),s.a.createElement(Se.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.state.openSnackbar,autoHideDuration:3e3,onClose:this.handleCloseSnackbar,ContentProps:{"aria-describedby":"message-id"},message:s.a.createElement("span",{id:"message-id"},this.state.note)}))}}]),t}(n.Component);var je=Object(B.b)(function(e){return{loggedIn:e.auth.loggedIn,rated:e.rate.rated,playlistFilm:e.playlistFilm.playlistFilm}})(De),xe=a(553),Re=a(285),Me=a.n(Re),He=z.a.CancelToken.source(),Ue=k.pathName,Te=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).loadComments=function(){a.setState({isLoading:!0},function(){a.props.handleLoading(a.state),z.a.get("".concat(k.apiUrl,"films/").concat(a.state.filmID,"/desc"),{params:{start:a.state.comments.length,limit:10}}).then(function(e){var t=e.data;a.setState({hasMore:t.comments.length>0,isLoading:!1,comments:[].concat(Object($.a)(a.state.comments),Object($.a)(t.comments))},function(){a.props.handleLoading(a.state)})}).catch(function(e){a.setState({error:e.message,isLoading:!1},function(){a.props.handleLoading(a.state)})})})},a.addComment=function(){if(localStorage.getItem("user")){var e={headers:O()};z.a.post("".concat(k.apiUrl,"films/").concat(a.state.filmID,"/comments"),{text:a.state.comment},e).then(function(e){if(200===e.status){var t=e.data;z.a.get("".concat(k.apiUrl,"users/").concat(t.author_id)).then(function(e){var n=a.state.comments;n.unshift({id:t._id,author:e.data.nick,comment:t.text,createdAt:t.createdAt}),a.setState({comment:"",comments:n,addedCount:a.state.addedCount+1})})}}).catch(function(e){console.log(e)})}else a.props.history.push("".concat(Ue,"film/").concat(a.state.filmID,"/login"))},a.sortComments=function(e){var t="";switch(e){case"commentByDate":t="date";break;case"commentByName":t="author"}""!==t&&(z.a.get("".concat(k.apiUrl,"films/").concat(a.state.filmID,"/comments/sort/").concat(t,"/").concat(a.state.dir),{params:{start:0,limit:a.state.comments.length}}).then(function(e){var t=e.data[0].comments,n=[];t.forEach(function(e){n.push({id:e.comment._id,author:e.author,comment:e.comment.text,createdAt:e.comment.createdAt})}),Promise.all(n).then(function(e){a.setState({comments:e})})}),a.setState({dir:-1*a.state.dir}))},a.state={filmID:"",comments:[],comment:"",dir:1,error:!1,hasMore:!0,isLoading:!1,isLoaded:!1,addedCount:0},a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({isLoading:!0,filmID:this.props.filmID},function(){z.a.get("".concat(k.apiUrl,"films/").concat(e.state.filmID,"/desc"),{params:{start:e.state.comments.length,limit:5}}).then(function(t){var a=t.data;e.setState({hasMore:a.comments.length>0,isLoading:!1,isLoaded:!0,comments:[].concat(Object($.a)(e.state.comments),Object($.a)(a.comments))})}).catch(function(t){e.setState({error:t.message,isLoading:!1})})})}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;e.isLoading!==this.props.isLoading&&(this.props.isLoading&&!this.state.error&&!this.state.isLoading&&this.state.hasMore?this.loadComments():this.props.handleLoading(this.state)),e.filmID!==this.props.filmID&&(He.cancel(),He=z.a.CancelToken.source(),this.setState({filmID:this.props.filmID,comment:"",dir:1,comments:[],isLoading:!0,isLoaded:!1,error:!1,hasMore:!0,addedCount:0},function(){n.props.handleLoading(n.state),z.a.get("".concat(k.apiUrl,"films/").concat(n.props.filmID,"/desc"),{cancelToken:He.token,params:{start:0,limit:5}}).then(function(e){var t=e.data;n.setState({hasMore:t.comments.length>0,isLoading:!1,isLoaded:!0,comments:t.comments},function(){n.props.handleLoading(n.state)})}).catch(function(e){z.a.isCancel(e)?console.log("Request canceled",e.message):n.setState({error:e.message,isLoading:!1,isLoaded:!0},function(){n.props.handleLoading(n.state)})})}))}},{key:"handleChange",value:function(e){this.setState({comment:e.target.value})}},{key:"render",value:function(){var e=this,t=this.props.commentsLength;return t+=this.state.addedCount,s.a.createElement(A.a,{className:"p-0 mt-4"},this.state.isLoaded&&s.a.createElement(A.a,null,s.a.createElement(A.a,{className:"p-0",sm:12},s.a.createElement(ee.a,null,s.a.createElement(A.a,{xs:8,sm:10},s.a.createElement(Me.a,{value:this.state.comment,onChange:this.handleChange,type:"text",id:"standard-multiline-flexible",label:"Comment",multiline:!0,fullWidth:!0,rowsMax:"4"})),s.a.createElement(A.a,{xs:2,sm:2},s.a.createElement(y.a,{className:"mt-3",variant:"primary",onClick:function(){return e.addComment()}},"Submit")))),s.a.createElement(A.a,{className:"p-0 mt-4 mb-4",sm:12},s.a.createElement(ee.a,null,s.a.createElement(A.a,{xs:7,sm:5,md:4},s.a.createElement("p",{className:"m-0"},t+" comments")),s.a.createElement(A.a,{xs:2,sm:2},s.a.createElement(xe.a,{alignRight:!0,variant:"secondary",title:"Sort",id:"dropdown-button-drop-down",onSelect:function(t){return e.sortComments(t)}},s.a.createElement(ie.a.Item,{eventKey:"commentByDate"},"By date"),s.a.createElement(ie.a.Item,{eventKey:"commentByName"},"By author name"))))),this.state.comments.map(function(e){return s.a.createElement(A.a,{className:"p-0 mt-4",sm:12,key:e.id},s.a.createElement(ee.a,{className:"pl-3"},s.a.createElement("p",{className:"m-0 font-weight-bold"},s.a.createElement("small",{className:"m-0 font-weight-bold"},e.author)),s.a.createElement("p",null,s.a.createElement("small",{className:"m-0"},"\u2002",function(e){var t=new Date(Date.parse(e.createdAt));return("0"+t.getDate()).slice(-2)+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getFullYear()).slice(-2)+" o "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)}(e)))),s.a.createElement("p",null,s.a.createElement("small",null,e.comment)))})),s.a.createElement(A.a,{style:{height:40},sm:12,className:"mb-2 text-center"},this.state.isLoading&&this.state.hasMore&&s.a.createElement(te.a,{animation:"border"})))}}]),t}(n.Component);var Pe=Object(B.b)(function(e){return{loggedIn:e.auth.loggedIn,rated:e.rate.rated}})(Te),Fe=a(69),Qe=a.n(Fe),Be=a(286),Ge=z.a.CancelToken.source(),ze=768,We=k.pathName,Ke=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).handleScroll=function(){a.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}}),window.innerHeight+document.documentElement.scrollTop>=document.body.offsetHeight-150&&(a.setState({isLoadingFilms:!0}),window.innerWidth<=ze&&a.state.hasMoreFilms||a.setState({isLoadingComments:!0}))},a.handleResize=function(){a.setState({windowWidth:window.innerWidth});var e=Qe.a.parse(a.props.location.search);e&&e.list&&a.setState({playlistHeight:a.filmElement.clientHeight})},a.updateMeta=function(e){if("views"===e||localStorage.getItem("user")){var t={headers:{"Content-Type":"application/json"}};if("views"===e)return z.a.put("".concat(k.apiUrl,"films/").concat(a.state.film.filmID,"/meta"),JSON.stringify({views:1}),t).then(function(e){a.setState({isLoading:!1})}).catch(function(e){a.setState({isLoading:!1})});var n={headers:O()};return z.a.put("".concat(k.apiUrl,"users/update/meta"),Object(ve.a)({},e,a.state.film.filmID),n).then(function(n){var s=n.data;return z.a.put("".concat(k.apiUrl,"films/").concat(a.state.film.filmID,"/meta"),s,t).then(function(t){a.props.dispatch(Q.rate(e.toString().toUpperCase())),a.setState({film:Object(ye.a)({},a.state.film,{dislikes:t.data.thumbsDown,likes:t.data.thumbsUp})})}).catch(function(e){})}).catch(function(e){console.log(e)})}a.props.history.push("".concat(We,"film/").concat(a.state.film.filmID,"/login"))},a.checkRate=function(){if("CHECK_RATE"===a.props.rated){var e=JSON.parse(localStorage.getItem("user"));if(!e)return;e.user.meta.liked.indexOf(a.state.film.filmID)>-1&&a.props.dispatch(Q.rate("LIKED")),e.user.meta.disliked.indexOf(a.state.film.filmID)>-1&&a.props.dispatch(Q.rate("DISLIKED"))}},a.handleSetThumbnail=function(e){a.setState({film:Object(ye.a)({},a.state.film,{poster:"https://thumbs.gfycat.com/VibrantHeavyFrogmouth-size_restricted.gif"})},function(){a.props.history.push("".concat(We,"film/")+e),a.props.dispatch(Q.rate("CHECK_RATE")),window.scrollTo(0,0)})},a.handleSetThumbnailPlaylist=function(e){a.props.match.params.id!==e&&a.setState({film:Object(ye.a)({},a.state.film,{poster:"https://thumbs.gfycat.com/VibrantHeavyFrogmouth-size_restricted.gif"})},function(){a.props.dispatch(Q.rate("CHECK_RATE"))}),window.scrollTo(0,0)},a.handleLoadingFilms=function(e){a.setState({isLoadingFilms:e.isLoading}),a.setState({hasMoreFilms:e.hasMore})},a.handleLoadingComments=function(e){a.setState({isLoadingComments:e.isLoading})},a.handleDeletePlaylist=function(){a.setState({displayPlaylist:!1})},a.state={film:{},isMounted:!1,isLoading:!1,isLoadingFilms:!1,isLoadingComments:!1,hasMoreFilms:!0,scroll:{},windowWidth:window.innerWidth,displayPlaylist:!1,playlistHeight:400,playlistID:null,error:!1,expanded:!1,truncated:!1},a.handleTruncate=a.handleTruncate.bind(Object(h.a)(Object(h.a)(a))),a.toggleLines=a.toggleLines.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleTruncate",value:function(e){e.preventDefault(),this.setState({truncated:!1,expanded:!0})}},{key:"toggleLines",value:function(e){e.preventDefault(),this.setState({expanded:!this.state.expanded})}},{key:"componentDidMount",value:function(){var e=this,t=Qe.a.parse(this.props.location.search);window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize),this.setState({film:Object(ye.a)({},this.state.film,{filmID:this.props.match.params.id})},function(){z.a.get("".concat(k.apiUrl,"films/").concat(e.props.match.params.id,"/desc/no")).then(function(a){var n=a.data,s={headers:O()};localStorage.getItem("user")&&z.a.get("".concat(k.apiUrl,"users/me"),s).then(function(t){t.data.meta.liked.indexOf(e.state.film.filmID)>-1&&e.props.dispatch(Q.rate("LIKED")),t.data.meta.disliked.indexOf(e.state.film.filmID)>-1&&e.props.dispatch(Q.rate("DISLIKED"))}),t&&t.list&&e.setState({displayPlaylist:!0,playlistHeight:e.filmElement.clientHeight,playlistID:t.list}),e.setState({film:Object(ye.a)({},e.state.film,{thumbnail:n.thumbnail,poster:"".concat(k.apiUrl,"films/").concat(e.state.film.filmID,"/thumbnail/").concat(n.thumbnail._id,"?width=poster"),views:n.views+1,title:n.title,description:n.description,likes:n.thumbsUp,dislikes:n.thumbsDown,commentsLength:n.commentsLength}),isMounted:!0}),e.updateMeta("views")}).catch(function(e){})})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;if(e.match.params.id!==this.props.match.params.id){Ge.cancel(),Ge=z.a.CancelToken.source();var s=Qe.a.parse(this.props.location.search);this.setState({isLoading:!0,film:Object(ye.a)({},this.state.film,{filmID:this.props.match.params.id}),isLoadingFilms:!1,isLoadingComments:!1,hasMoreFilms:!0,expanded:!1,truncated:!1},function(){z.a.get("".concat(k.apiUrl,"films/").concat(n.props.match.params.id,"/desc/no"),{cancelToken:Ge.token}).then(function(e){s&&s.list?n.setState({displayPlaylist:!0,playlistHeight:n.filmElement.clientHeight,playlistID:s.list}):n.setState({displayPlaylist:!1,playlistHeight:400,playlistID:null});var t=e.data,a={headers:O()};localStorage.getItem("user")&&z.a.get("".concat(k.apiUrl,"users/me"),a).then(function(e){e.data.meta.liked.indexOf(n.state.film.filmID)>-1&&n.props.dispatch(Q.rate("LIKED")),e.data.meta.disliked.indexOf(n.state.film.filmID)>-1&&n.props.dispatch(Q.rate("DISLIKED"))}),n.setState({film:Object(ye.a)({},n.state.film,{thumbnail:t.thumbnail,views:t.views+1,title:t.title,description:t.description,likes:t.thumbsUp,dislikes:t.thumbsDown,commentsLength:t.commentsLength}),isMounted:!0}),n.setState({film:Object(ye.a)({},n.state.film,{poster:"".concat(k.apiUrl,"films/").concat(n.state.film.filmID,"/thumbnail/").concat(t.thumbnail._id,"?width=poster")})}),n.updateMeta("views")}).catch(function(e){console.log(JSON.stringify(e))})})}}},{key:"render",value:function(){var e=this,t=this.props.rated,a=this.props.loggedIn,n=this.state,i=n.expanded,l=n.truncated;return this.checkRate(),s.a.createElement(A.a,null,s.a.createElement(ee.a,null,s.a.createElement(A.a,{md:8},s.a.createElement(A.a,{className:"mt-4",sm:12},s.a.createElement("div",{className:"",ref:function(t){return e.filmElement=t}},s.a.createElement(Be.Player,{className:"",playsInline:!0,poster:this.state.film.poster,src:this.state.film.videoSrc}))),this.state.isMounted&&!this.state.isLoading?s.a.createElement(A.a,{className:"pl-3 pr-3 mt-4",sm:12},s.a.createElement(ee.a,null,s.a.createElement(A.a,{sm:12},s.a.createElement("p",{className:"font-weight-bold"},this.state.film.title)),s.a.createElement(A.a,{xs:4,sm:4},s.a.createElement("p",null,s.a.createElement(p.a,{icon:"eye"})," \u2002",this.state.film.views)),s.a.createElement(A.a,{xs:4,sm:4,className:"text-right"},s.a.createElement("p",{className:"".concat(a&&"LIKED"===t?"blue":""," font-weight-bold")},s.a.createElement(p.a,{cursor:"pointer",onClick:function(){return e.updateMeta("liked")},icon:"thumbs-up"}),"\u2002",this.state.film.likes)),s.a.createElement(A.a,{xs:4,sm:4},s.a.createElement("p",{className:"".concat(a&&"DISLIKED"===t?"blue":""," font-weight-bold")},s.a.createElement(p.a,{cursor:"pointer",onClick:function(){return e.updateMeta("disliked")},icon:"thumbs-down"}),"\u2002",this.state.film.dislikes)),s.a.createElement(A.a,{sm:12,className:"mt-4 mb-4 divider"}),s.a.createElement(A.a,{sm:12},s.a.createElement(ue.a,{line:!i&&2,truncateText:"\u2026",text:this.state.film.description,textTruncateChild:s.a.createElement("span",{id:"s-c-2"},s.a.createElement(y.a,{variant:"link",style:{display:"block"},className:"p-0 m-0 mb-1 title font-weight-bold",onClick:this.handleTruncate},"Read more"))}),!l&&i&&s.a.createElement("span",{style:{display:"block"}},s.a.createElement(y.a,{className:"p-0 m-0 mb-1 title font-weight-bold",variant:"link",onClick:this.toggleLines},"Show less"))))):this.state.isMounted?s.a.createElement(A.a,{style:{height:80},sm:12,className:"pl-3 pr-3 mb-2 text-center justify-content-center d-flex align-items-center"}):null,s.a.createElement(A.a,{sm:12,className:"mt-4 mb-2 divider d-block d-md-none"}),this.state.displayPlaylist&&this.state.windowWidth<=ze&&this.state.isMounted&&s.a.createElement(A.a,{className:"p-0 d-block d-md-none"},s.a.createElement(je,{id:this.state.playlistID,filmID:this.props.match.params.id,filmElement:this.filmElement,history:this.props.history,windowWidth:this.state.windowWidth,handleSubmit:this.handleSetThumbnailPlaylist,handleDeletePlaylist:this.handleDeletePlaylist})),this.state.windowWidth<=ze&&this.state.isMounted&&s.a.createElement(A.a,{className:"mt-4 d-block d-md-none"},s.a.createElement(Oe,{hasMoreFilms:this.state.hasMoreFilms,isLoading:this.state.isLoadingFilms,filmID:this.props.match.params.id,history:this.props.history,playlistID:this.state.playlistID,handleLoading:this.handleLoadingFilms,handleThumbnail:this.handleSetThumbnail})),(this.state.windowWidth<=ze&&!this.state.hasMoreFilms||this.state.windowWidth>ze)&&this.state.isMounted&&s.a.createElement(A.a,{className:"p-0 "},s.a.createElement(A.a,{sm:12,className:"mt-4 mb-2 divider"}),s.a.createElement(Pe,{isLoading:this.state.isLoadingComments,filmID:this.props.match.params.id,history:this.props.history,commentsLength:this.state.film.commentsLength,handleLoading:this.handleLoadingComments}))),s.a.createElement(A.a,{sm:4},this.state.displayPlaylist&&this.state.windowWidth>ze&&this.state.isMounted&&s.a.createElement(A.a,{className:"p-0 d-none d-md-block",sm:10},s.a.createElement(je,{id:this.state.playlistID,filmID:this.props.match.params.id,filmElement:this.filmElement,history:this.props.history,windowWidth:this.state.windowWidth,handleSubmit:this.handleSetThumbnailPlaylist,handleDeletePlaylist:this.handleDeletePlaylist})),this.state.windowWidth>ze&&this.state.isMounted&&s.a.createElement(A.a,{className:"p-0 mt-4 d-none d-md-block",sm:12},s.a.createElement(Oe,{hasMoreFilms:this.state.hasMoreFilms,isLoading:this.state.isLoadingFilms,filmID:this.props.match.params.id,history:this.props.history,playlistID:this.state.playlistID,handleLoading:this.handleLoadingFilms,handleThumbnail:this.handleSetThumbnail})))))}}]),t}(n.Component);var _e=Object(B.b)(function(e){return{loggedIn:e.auth.loggedIn,rated:e.rate.rated}})(Ke),Ye=a(555),Je=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).handleForgotPassword=function(){a.props.history.goBack(),setTimeout(function(){this.props.history.push("".concat(this.props.location.pathname.slice(0,-5),"forgot").concat(this.props.location.search))}.bind(Object(h.a)(Object(h.a)(a))),500)},a.state={email:"",password:"",submitted:!1,show:!0},a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleChange",value:function(e){var t=e.target,a=t.name,n=t.value;this.setState(Object(ve.a)({},a,n))}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({submitted:!0});var t=this.state,a=t.email,n=t.password,s=this.props.dispatch;a&&n&&s(Q.login(a,n))}},{key:"render",value:function(){var e=this,t=function(){e.setState({show:!1}),e.props.history.goBack()},a=this.props.loggingIn,n=this.props.alert,i=this.state,l=i.email,r=i.password,o=i.submitted;return s.a.createElement(Ye.a,{onHide:t,show:this.state.show,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0},s.a.createElement(Ye.a.Header,{closeButton:!0},s.a.createElement(Ye.a.Title,{id:"contained-modal-title-vcenter"},"Login")),s.a.createElement(Ye.a.Body,null,s.a.createElement(E.a,{onSubmit:this.handleSubmit},s.a.createElement(E.a.Group,null,s.a.createElement(E.a.Label,{htmlFor:"email"},"Email"),s.a.createElement(E.a.Control,{isInvalid:o&&!l,type:"email",name:"email",value:l,onChange:this.handleChange}),s.a.createElement(E.a.Control.Feedback,{type:"invalid"},"Email is required")),s.a.createElement(E.a.Group,null,s.a.createElement(E.a.Label,{htmlFor:"password"},"Password"),s.a.createElement(E.a.Control,{isInvalid:o&&!r,type:"password",name:"password",value:r,onChange:this.handleChange}),s.a.createElement(E.a.Control.Feedback,{type:"invalid"},"Password is required")),s.a.createElement(E.a.Group,null,s.a.createElement(y.a,{type:"submit",className:"btn-primary"},"Login"),a&&s.a.createElement("img",{alt:"loading...",className:"pl-2",src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="}))),n.message&&s.a.createElement(A.a,{className:"alert ".concat(n.type)},n.message),s.a.createElement(y.a,{variant:"link",onClick:function(){e.props.history.goBack(),setTimeout(function(){this.props.history.push("".concat(this.props.location.pathname.slice(0,-5),"register").concat(this.props.location.search))}.bind(e),500)},className:"p-0 m-0 btn btn-link"},"Register"),s.a.createElement(A.a,{className:"p-0 m-0 ",xs:12,sm:12},s.a.createElement(y.a,{variant:"link",onClick:this.handleForgotPassword,className:"p-0 m-0 btn btn-link"},"Forgot password?"))),s.a.createElement(Ye.a.Footer,null,s.a.createElement(y.a,{onClick:t},"Close")))}}]),t}(s.a.Component);var Ve=Object(B.b)(function(e){return{loggingIn:e.auth.loggingIn,alert:e.alert}})(Je),qe=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).props.dispatch(Q.logout()),a.state={user:{nick:"",email:"",password:""},submitted:!1,show:!0},a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleChange",value:function(e){var t=e.target,a=t.name,n=t.value,s=this.state.user;this.setState({user:Object(ye.a)({},s,Object(ve.a)({},a,n))})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({submitted:!0});var t=this.state.user,a=this.props.dispatch;t.email&&t.nick&&t.password&&t.password.length>=6&&a(Q.register(t))}},{key:"render",value:function(){var e=this,t=function(){e.setState({show:!1}),e.props.history.goBack()},a=this.props.registering,n=this.state,i=n.user,l=n.submitted,r=this.props.alert;return s.a.createElement(Ye.a,{onHide:t,show:this.state.show,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0},s.a.createElement(Ye.a.Header,{closeButton:!0},s.a.createElement(Ye.a.Title,{id:"contained-modal-title-vcenter"},"Register")),s.a.createElement(Ye.a.Body,null,s.a.createElement(E.a,{onSubmit:this.handleSubmit},s.a.createElement(E.a.Group,null,s.a.createElement(E.a.Label,{htmlFor:"nick"},"Nick"),s.a.createElement(E.a.Control,{isInvalid:l&&!i.nick,type:"text",name:"nick",value:i.nick,onChange:this.handleChange}),s.a.createElement(E.a.Control.Feedback,{type:"invalid"},"Nick is required")),s.a.createElement(E.a.Group,null,s.a.createElement(E.a.Label,{htmlFor:"email"},"Email"),s.a.createElement(E.a.Control,{isInvalid:l&&!i.email||"alert-danger"===r.type&&r.message,type:"email",name:"email",value:i.email,onChange:this.handleChange}),s.a.createElement(E.a.Control.Feedback,{type:"invalid"},r.message?r.message:"Email is required")),s.a.createElement(E.a.Group,null,s.a.createElement(E.a.Label,{htmlFor:"password"},"Password"),s.a.createElement(E.a.Control,{isInvalid:l&&i.password.length<6,type:"password",name:"password",value:i.password,maxLength:"11",onChange:this.handleChange}),s.a.createElement(E.a.Control.Feedback,{type:"invalid"},0===i.password.length?"Password is required":"Password too short (min 6 chars)")),s.a.createElement(E.a.Group,null,s.a.createElement(y.a,{type:"submit",className:"btn-primary"},"Register"),a&&s.a.createElement("img",{alt:"loading...",className:"pl-2",src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="})))),s.a.createElement(Ye.a.Footer,null,s.a.createElement(y.a,{onClick:t},"Close")))}}]),t}(s.a.Component);var Ze=Object(B.b)(function(e){return{registering:e.registration.registering,alert:e.alert}})(qe),Xe=a(276),$e=a(288),et=a.n($e),tt=(a(543),a(289)),at=k.pathName,nt=[{id:"last_hour",title:"Last hour"},{id:"today",title:"Today"},{id:"this_week",title:"This week"},{id:"this_month",title:"This month"},{id:"this_year",title:"This year"}],st=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).handleScroll=function(){if(a.state.addOpenedIndex>=0&&!fe.isMobile){var e=a.state.films;e[a.state.addOpenedIndex].add=!1,a.setState({films:e,addOpenedIndex:-1})}a.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}});var t=Object(h.a)(Object(h.a)(a)),n=t.loadData,s=t.state,i=s.error,l=s.isLoading,r=s.hasMore;i||l||!r||window.innerHeight+document.documentElement.scrollTop>=document.body.offsetHeight-150&&n()},a.handleResize=function(){a.setState({windowWidth:window.innerWidth})},a.handlePlaylistOperation=function(e){if(a.state.addOpenedIndex>=0){var t=a.state.films;t.forEach(function(e){e.add=!1}),a.setState({films:t,addOpenedIndex:-1})}a.setState({openSnackbar:!0,note:e})},a.handleClickOutside=function(e){if(a.state.addOpenedIndex>=0){var t=a.state.films;t.forEach(function(e){e.add=!1}),a.setState({films:t,addOpenedIndex:e})}},a.handleCreatePlaylistClick=function(){a.setState({addOpenedIndex:-1})},a.handleAddPlaylistButtonClick=function(e){var t=a.state.films;t[e].add=!t[e].add,a.setState({films:t,addOpenedIndex:e})},a.handleCloseSnackbar=function(e,t){"clickaway"!==t&&a.setState({openSnackbar:!1})},a.loadData=function(){a.setState({isLoading:!0},function(){z.a.get("".concat(k.apiUrl,"films/filter/title/?search=").concat(a.state.search,"&sort=").concat(a.state.sort,"&filter=").concat(a.state.filter,"&dir=").concat(a.state.dir),{params:{start:a.state.films.length,limit:a.state.films.length<5?5:a.state.films.length+5}}).then(function(e){var t=e.data;a.setState({hasMore:t.length<1e3,films:[].concat(Object($.a)(a.state.films),Object($.a)(t)),isLoading:!1})}).catch(function(e){console.log(e)})})},a.parseDate=function(e){var t=new Date(Date.parse(e.createdAt)),a=new Date,n=Math.abs(Math.floor((Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes())-Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes()))/6e4));return n/60>=1?(n/=60)/24>=1?(n/=24)/30>=1?(n/=30)/12>=1?(n/=12,n=Math.floor(n)+" years "):n=Math.floor(n)+" months ":n=Math.floor(n)+" days ":n=Math.floor(n)+" hours ":n=Math.floor(n)+" minutes ",n+="ago"},a.setRedirect=function(e,t){e&&e.target&&("s-c-1"===e.target.id||"s-c-2"===e.target.id||"s-c-3"===e.target.id||"s-c-4"===e.target.id||"path"===e.target.localName&&e.target.parentElement&&e.target.parentElement.parentElement&&"a-b-2"!==e.target.parentElement.parentElement.id)&&a.props.history.push("".concat(at,"film/")+t)},a.handleOnclick=function(e,t){a.setState({click:!0});var n=a.state.filter,s=a.state.sort,i=a.state.dir;"filter"===e?a.state.filter===t.id?(a.setState({filter:""}),s=a.state.sort,n="",i=a.state.dir):(a.setState({filter:t.id}),s=a.state.sort,n=t.id,i=a.state.dir):a.state.sort===t.id?(s=t.id,1===t.dir?(t.dir=-1,a.setState({dir:-1}),i=t.dir):-1===t.dir&&(a.setState({sort:""}),n=a.state.filter,t.dir=1,s="",a.setState({dir:1}))):(a.setState({sort:t.id}),n=a.state.filter,s=t.id,i=t.dir),""!==s&&""!==n?a.props.history.push({search:"?search=".concat(a.state.search,"&sort=").concat(s,"&dir=").concat(i,"&filter=").concat(n)}):""===s&&""!==n?a.props.history.push({search:"?search=".concat(a.state.search,"&filter=").concat(n)}):""!==s&&""===n?a.props.history.push({search:"?search=".concat(a.state.search,"&sort=").concat(s,"&dir=").concat(i)}):""===s&&""===n&&a.props.history.push({search:"?search=".concat(a.state.search)}),z.a.get("".concat(k.apiUrl,"films/filter/title/?search=").concat(a.state.search,"&sort=").concat(s,"&filter=").concat(n,"&dir=").concat(i),{params:{start:0,limit:a.state.films.length<5?5:a.state.films.length}}).then(function(e){var t=e.data;a.setState({films:t})}).catch(function(e){})},a.state={films:[],addOpenedIndex:-1,click:!1,error:!1,hasMore:!1,isLoading:!1,scroll:{},windowWidth:window.innerWidth,open:!1,openSnackbar:!1,filter:"",sort:"",dir:1,sorts:[{id:"upload_date",title:"Upload date",dir:1},{id:"view_count",title:"View count",dir:1},{id:"rating",title:"Rating",dir:1}]},window.onresize=function(){a.setState({windowWidth:window.innerWidth})},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize),this.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}});var t=Qe.a.parse(this.props.location.search);this.setState({isLoading:!0,search:t.search,dir:t.dir?t.dir:1,sort:t.sort?t.sort:"",filter:t.filter?t.filter:""},function(){z.a.get("".concat(k.apiUrl,"films/filter/title/?search=").concat(e.state.search,"&sort=").concat(e.state.sort,"&filter=").concat(e.state.filter,"&dir=").concat(e.state.dir),{params:{start:0,limit:5}}).then(function(t){var a=t.data;a.forEach(function(e){e.add=!1}),e.setState({hasMore:a.length<1e3,films:[].concat(Object($.a)(e.state.films),Object($.a)(a)),isLoading:!1})}).catch(function(e){console.log(e)})})}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;if(this.state.click)this.setState({click:!1});else{var s=Qe.a.parse(this.props.location.search),i=Qe.a.parse(e.location.search);!1===et.a.isEqual(i,s)&&(this.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}}),this.setState({films:[],addOpenedIndex:-1,click:!1,error:!1,hasMore:!1,scroll:{},windowWidth:window.innerWidth,open:!1,openSnackbar:!1,isLoading:!0,search:s.search,dir:s.dir?s.dir:1,sort:s.sort?s.sort:"",filter:s.filter?s.filter:""},function(){s.sort&&""!==s.sort&&n.state.sorts.forEach(function(e){e.id===s.sort&&(e.dir=parseInt(s.dir))}),z.a.get("".concat(k.apiUrl,"films/filter/title/?search=").concat(n.state.search,"&sort=").concat(n.state.sort,"&filter=").concat(n.state.filter,"&dir=").concat(n.state.dir),{params:{start:0,limit:5}}).then(function(e){var t=e.data;t.forEach(function(e){e.add=!1}),n.setState({hasMore:t.length<1e3,films:[].concat(Object($.a)(n.state.films),Object($.a)(t)),isLoading:!1})}).catch(function(e){console.log(e)})}))}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this,t=this.state.scroll,a=this.state.open;return s.a.createElement(A.a,null,s.a.createElement(ne.a,{onClick:function(){return e.setState({open:!a})},"aria-controls":"filter-collapse","aria-expanded":a,className:"mt-3 p-2 button-my"},s.a.createElement(p.a,{style:{cursor:"pointer"},icon:"filter"})),s.a.createElement(Xe.a,{in:this.state.open},s.a.createElement(ee.a,{id:"filter-collapse"},s.a.createElement(A.a,{className:"mt-4",sm:4},s.a.createElement("p",{style:{fontWeight:500}},"UPLOAD DATE"),s.a.createElement(A.a,{sm:8,className:"mt-3 mb-3 divider"}),nt.map(function(t){return s.a.createElement("p",{key:t.id,style:e.state.filter===t.id?{fontWeight:700,fontSize:"80%"}:{fontWeight:400,fontSize:"80%"},onClick:function(){return e.handleOnclick("filter",t)},className:"filter-search"},t.title)})),s.a.createElement(A.a,{className:"mt-4",sm:4},s.a.createElement("p",{style:{fontWeight:500}},"SORT BY"),s.a.createElement(A.a,{sm:8,className:"mt-3 mb-3 divider"}),this.state.sorts.map(function(t){return s.a.createElement(ee.a,{key:t.id,className:"ml-0"},s.a.createElement("p",{style:e.state.sort===t.id?{fontWeight:700,fontSize:"80%"}:{fontWeight:400,fontSize:"80%"},onClick:function(){return e.handleOnclick("sort",t)},className:"filter-search"},t.title),e.state.sort===t.id&&1===t.dir?s.a.createElement(p.a,{className:"ml-2",icon:"sort-up"}):e.state.sort===t.id&&-1===t.dir?s.a.createElement(p.a,{className:"ml-2",icon:"sort-down"}):"")})))),s.a.createElement(A.a,{sm:12,className:"mt-2 mb-3 divider"}),s.a.createElement(ee.a,null,s.a.createElement(A.a,{className:"mt-4"},this.state.films.map(function(t,a){var n=e.parseDate(t),i=e.state.windowWidth<1200&&e.state.windowWidth>576?1:2;return s.a.createElement(A.a,{xs:12,sm:12,lg:8,className:"film-preview-holder m-0 mb-1 container",onClick:function(a){return e.setRedirect(a,t.id)},key:t.id},s.a.createElement(ee.a,{className:"d-sm-none mb-4"},s.a.createElement(A.a,{xs:8,sm:4},s.a.createElement("div",{className:"embed-responsive embed-responsive-16by9 z-depth-1-half"},s.a.createElement("img",{alt:"",id:"s-c-1",className:"image embed-responsive-item",src:"".concat(k.apiUrl,"films/").concat(t.id,"/thumbnail/").concat(t.thumbnail._id,"?width=small")}),s.a.createElement(p.a,{className:"middle",icon:"play"}))),s.a.createElement(A.a,{xs:4,sm:8,className:"p-0"},s.a.createElement(ee.a,{className:"m-0"},s.a.createElement(A.a,{xs:10,sm:10,className:"p-0"},s.a.createElement(ue.a,{line:1,id:"s-c-2",className:"mb-1 title-search font-weight-bold",text:t.title})),e.state.windowWidth<576&&s.a.createElement(me,{parentName:"search",filmID:t.id,show:t.add,index:a,handleAddPlaylistButtonClick:e.handleAddPlaylistButtonClick,handleClick:e.handleCreatePlaylistClick,handleClickOutside:e.handleClickOutside,handlePlaylistOperation:e.handlePlaylistOperation})),s.a.createElement("p",{id:"s-c-3",className:"mb-0 author-nick"},s.a.createElement("small",null,t.author_name," \xb7 ",t.views," views")))),s.a.createElement(A.a,{className:"d-none d-sm-inline"},s.a.createElement(ee.a,{className:"style-search"},s.a.createElement(A.a,{xs:8,sm:4},s.a.createElement("div",{className:"embed-responsive embed-responsive-16by9 z-depth-1-half"},s.a.createElement("img",{alt:"",id:"s-c-1",className:"image embed-responsive-item",src:"".concat(k.apiUrl,"films/").concat(t.id,"/thumbnail/").concat(t.thumbnail._id,"?width=small")}),s.a.createElement(p.a,{className:"middle",icon:"play"}))),s.a.createElement(A.a,{xs:4,sm:8,className:"p-0 "},s.a.createElement(ee.a,{className:"m-0"},s.a.createElement(A.a,{xs:10,sm:10,className:"p-0 mb-1"},s.a.createElement(tt.a,{lines:i,id:"s-c-2",className:"mb-0 title-search font-weight-bold"},t.title)),e.state.windowWidth>=576&&s.a.createElement(me,{parentName:"search",filmID:t.id,show:t.add,index:a,handleAddPlaylistButtonClick:e.handleAddPlaylistButtonClick,handleClick:e.handleCreatePlaylistClick,handleClickOutside:e.handleClickOutside,handlePlaylistOperation:e.handlePlaylistOperation})),s.a.createElement("p",{id:"s-c-3",className:"mb-1 author-nick-search"},s.a.createElement("small",null,t.author_name," \xb7 ",t.views," views \xb7 ",n)),s.a.createElement("small",null,s.a.createElement(ue.a,{id:"s-c-4",className:"mb-0 author-nick-search",line:i,text:t.description}))))))}))),s.a.createElement(A.a,{style:{height:40},sm:12,className:"text-center"},!(0===t.scrollTop||t.offsetHeight<=t.innerHeight)&&this.state.isLoading&&s.a.createElement(te.a,{animation:"border"})),s.a.createElement(Se.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.state.openSnackbar,autoHideDuration:3e3,onClose:this.handleCloseSnackbar,ContentProps:{"aria-describedby":"message-id"},message:s.a.createElement("span",{id:"message-id"},this.state.note)}))}}]),t}(n.Component);var it=Object(se.a)(function(e){return{loggedIn:e.auth.loggedIn}})(st),lt=k.pathName,rt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).handleScroll=function(){a.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}});var e=Object(h.a)(Object(h.a)(a)),t=e.loadData,n=e.state,s=n.error,i=n.isLoading,l=n.hasMore;s||i||!l||window.innerHeight+document.documentElement.scrollTop>=document.body.offsetHeight-150&&t()},a.handleResize=function(){a.setState({windowWidth:window.innerWidth})},a.loadData=function(){a.setState({isLoading:!0},function(){z.a.get("".concat(k.apiUrl,"playlists/all"),{params:{start:a.state.playlists.length,limit:6}}).then(function(e){var t=e.data;a.setState({hasMore:6===t.length,isLoading:!1,playlists:[].concat(Object($.a)(a.state.playlists),Object($.a)(t))})}).catch(function(e){a.setState({error:e.message,isLoading:!1})})})},a.setRedirect=function(e,t){a.props.history.push({pathname:"".concat(lt,"film/")+t,search:"?list=".concat(e)})},a.state={playlists:[],error:!1,hasMore:!1,isLoading:!1,scroll:{},windowWidth:window.innerWidth},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize);var t={headers:O()};localStorage.getItem("user")&&z.a.get("".concat(k.apiUrl,"users/me"),t).then(function(e){}).catch(function(t){e.props.dispatch(Q.logout())}),this.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}}),this.setState({isLoading:!0},function(){var t=3,a=e.state.windowWidth;a<=576?t=1.3:a>1920?t=6:a>1422&&(t=5),z.a.get("".concat(k.apiUrl,"playlists/all"),{params:{start:0,limit:Math.ceil(6*t)}}).then(function(a){var n=a.data;e.setState({hasMore:n.length>=Math.ceil(6*t),playlists:n,isLoading:!1})})})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this,t=this.state.isLoading,a=this.state.scroll;return s.a.createElement(A.a,null,s.a.createElement(ee.a,{className:"mt-5"},this.state.playlists.map(function(t,a){var n=t.filmThumbnail?t.filmThumbnail:t.films[0],i=t.id;return t.thumbnail?s.a.createElement(A.a,{className:"mb-5 film-preview-holder",xs:6,sm:4,md:3,lg:2,key:t.id},s.a.createElement("div",{onClick:function(){return e.setRedirect(i,n)},className:"embed-responsive embed-responsive-16by9 z-depth-1-half container"},s.a.createElement("img",{alt:"",className:"embed-responsive-item image",src:"".concat(k.apiUrl,"films/").concat(n,"/thumbnail/").concat(t.thumbnail,"?width=small"),onClick:function(){return e.setRedirect(i,n)}}),s.a.createElement(ee.a,{className:"middle"},s.a.createElement(A.a,{xs:4,sm:4},s.a.createElement(p.a,{icon:"play"})),s.a.createElement(A.a,{xs:8,sm:8},s.a.createElement("small",{className:"font-weight-bold"},"Play all")))),s.a.createElement("p",{className:"mb-1"},s.a.createElement("small",{className:"font-weight-bolder"},t.title)),s.a.createElement("p",{className:"mb-0 author-nick"},s.a.createElement("small",null,t.authorName))):null})),(0===a.scrollTop||a.offsetHeight<=a.innerHeight)&&this.state.hasMore&&s.a.createElement(A.a,{sm:12,className:"text-center"},s.a.createElement(ne.a,{className:"button-my",variant:"contained",disabled:t,onClick:t?null:this.loadData},t?"Loading\u2026":"Click to load")),s.a.createElement(A.a,{style:{height:40},sm:12,className:"text-center"},!(0===a.scrollTop||a.offsetHeight<=a.innerHeight)&&this.state.isLoading&&s.a.createElement(te.a,{animation:"border"})))}}]),t}(n.Component);var ot=Object(se.a)(function(e){return{loggedIn:e.auth.loggedIn}})(rt),ct=(a(544),a(176)),mt="Choose a film ",dt="Choose a thumbnail ",ht=k.pathName,pt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).handleDropFilm=function(e,t){a.setState({film:e[0],filmName:e[0].name,filmPreview:URL.createObjectURL(e[0])})},a.handleDropThumbnail=function(e,t){a.setState({thumbnail:e[0],thumbnailName:e[0].name,thumbnailPreview:URL.createObjectURL(e[0])})},a.state={title:"",description:"",submitted:!1,film:null,filmName:mt,filmPreview:null,thumbnail:null,thumbnailName:dt,thumbnailPreview:null,isLoading:!1,alert:{type:"",message:""}},a.filmInput=s.a.createRef(),a.thumbnailInput=s.a.createRef(),a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(h.a)(Object(h.a)(a))),a.handleFileChoose=a.handleFileChoose.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleChange",value:function(e){console.log(e.target);var t=e.target,a=t.name,n=t.value;this.setState(Object(ve.a)({},a,n))}},{key:"handleSubmit",value:function(e){var t=this;if(e.preventDefault(),this.setState({submitted:!0}),localStorage.getItem("user")){var a={headers:O()},n=new FormData;n.set("title",this.state.title),n.set("description",this.state.description),n.set("file",this.state.film),n.set("thumbnail",this.state.thumbnail),this.setState({isLoading:!0},function(){return z.a.post("".concat(k.apiUrl,"films"),n,a).then(function(e){t.props.history.push("".concat(ht,"film/").concat(e.data.id))}).catch(function(e){e.response.data.error?(t.setState({isLoading:!1,alert:{type:"alert-danger",message:e.response.data.error}}),422===e.response.status&&t.setState({film:null,filmName:mt,filmPreview:null,thumbnail:null,thumbnailName:dt,thumbnailPreview:null})):e.response.data.errors&&(e.response.data.errors.description?t.setState({isLoading:!1,alert:{type:"alert-danger",message:e.response.data.errors.description.message}}):e.response.data.errors.title&&t.setState({isLoading:!1,alert:{type:"alert-danger",message:e.response.data.errors.title.message}}))})})}else this.props.history.push("".concat(ht,"add/login"))}},{key:"handleFileChoose",value:function(e,t){switch(e.preventDefault(),t){case"film":this.setState({film:this.filmInput.current.files[0],filmName:this.filmInput.current.files[0].name,filmPreview:URL.createObjectURL(e.target.files[0])});break;case"thumbnail":this.setState({thumbnail:this.thumbnailInput.current.files[0],thumbnailName:this.thumbnailInput.current.files[0].name,thumbnailPreview:URL.createObjectURL(e.target.files[0])})}}},{key:"render",value:function(){var e=this,t=this.state.isLoading;return s.a.createElement(ee.a,{className:"mt-4 mr-2 ml-2",sm:12},s.a.createElement(A.a,{className:"mb-4",sm:6,lg:5},s.a.createElement(A.a,{className:"mb-4 ml-auto mr-auto",xs:10,sm:12,lg:10},s.a.createElement("div",{className:"embed-responsive embed-responsive-16by9 z-depth-1-half"},s.a.createElement(ct.a,{onDrop:this.handleDropFilm,className:"justify-content-center d-flex align-items-center embed-responsive-item text-center box has-advanced-upload"},s.a.createElement("input",{id:"film",accept:"video/mp4, video/ogg",onChange:function(t){return e.handleFileChoose(t,"film")},type:"file",ref:this.filmInput,className:"inputfile"}),s.a.createElement("label",{htmlFor:"film"},this.state.filmName===mt&&s.a.createElement("span",null,this.state.filmName)),this.state.filmName===mt&&s.a.createElement("span",null,"or drop it here"),this.state.filmPreview&&s.a.createElement("video",{muted:!0,autoPlay:!0,className:"embed-responsive-item",src:this.state.filmPreview})))),s.a.createElement(A.a,{className:"ml-auto mr-auto",xs:10,sm:12,lg:10},s.a.createElement("div",{className:"embed-responsive embed-responsive-16by9 z-depth-1-half"},s.a.createElement(ct.a,{onDrop:this.handleDropThumbnail,className:"justify-content-center d-flex align-items-center embed-responsive-item text-center box has-advanced-upload"},s.a.createElement("input",{id:"thumbnail",accept:"image/jpg, image/png, image/jpeg",onChange:function(t){return e.handleFileChoose(t,"thumbnail")},type:"file",ref:this.thumbnailInput,className:" inputfile"}),s.a.createElement("label",{htmlFor:"thumbnail"},this.state.thumbnailName===dt&&s.a.createElement("span",null,this.state.thumbnailName)),this.state.thumbnailName===dt&&s.a.createElement("span",null,"or drop it here"),this.state.thumbnailPreview&&s.a.createElement("img",{alt:"",className:"embed-responsive-item",src:this.state.thumbnailPreview}))))),s.a.createElement(A.a,{className:"mb-2",sm:6,lg:5},s.a.createElement(A.a,{className:"mb-3",sm:12},s.a.createElement(b.a,{placeholder:"Title","aria-label":"Title","aria-describedby":"basic-addon1",name:"title",value:this.state.title,onChange:this.handleChange})),s.a.createElement(A.a,{className:"mb-3",sm:12},s.a.createElement(b.a,{placeholder:"Description",as:"textarea","aria-label":"With textarea",name:"description",value:this.state.description,onChange:this.handleChange})),s.a.createElement(A.a,{className:"mb-3",sm:12},s.a.createElement(y.a,{variant:"primary",disabled:t,onClick:t?null:this.handleSubmit},t?"Loading\u2026":"Add")),this.state.alert.message&&s.a.createElement(A.a,{className:"alert ".concat(this.state.alert.type)},this.state.alert.message)))}}]),t}(n.Component);var ut=Object(se.a)(function(e){return{loggedIn:e.auth.loggedIn}})(pt),ft=a(290),gt=a.n(ft),At=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement(A.a,{xs:12,sm:12,className:"embed-responsive embed-responsive-16by9"},s.a.createElement("img",{className:"embed-responsive-item",src:gt.a,alt:""}))}}]),t}(n.Component),Et=a(100),bt=a(96),yt=a(40),vt=a(554),wt=k.pathName,St=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).props.dispatch(Q.logout()),a.state={user:{password:""},submitted:!1,show:!0,resetRequested:!1,resetSuccessful:!1,resetError:!1,errorMessage:""},a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a.handleSubmitPasswordChange=a.handleSubmitPasswordChange.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleChange",value:function(e){this.setState({submitted:!1,resetError:!1});var t=e.target,a=t.name,n=t.value,s=this.state.user;this.setState({user:Object(ye.a)({},s,Object(ve.a)({},a,n))})}},{key:"handleSubmitPasswordChange",value:function(e){var t=this;e.preventDefault(),this.setState({submitted:!0,resetRequested:!0,resetError:!1});var a=this.state.user;this.props.match.params.token&&a.password&&a.password.length>=6?z.a.post("".concat(k.apiUrl,"users/password/reset/").concat(this.props.match.params.token),{password:this.state.user.password}).then(function(e){t.setState({resetSuccessful:!0,resetRequested:!1}),setTimeout(function(){this.setState({show:!1}),this.props.history.push("".concat(wt)),setTimeout(function(){this.props.history.push("".concat(wt,"login"))}.bind(this),500)}.bind(t),1500)}).catch(function(e){var a="";e.response&&e.response.data&&e.response.data.errors&&(a=e.response.data.errors),t.setState({resetError:!0,resetSuccessful:!1,resetRequested:!1,errorMessage:a})}):this.setState({resetRequested:!1})}},{key:"render",value:function(){var e=this,t=function(){e.setState({show:!1}),e.props.history.push("".concat(wt))},a=this.state,n=a.user,i=a.submitted,l=a.resetSuccessful,r=a.resetRequested,o=a.resetError,c=a.errorMessage;return s.a.createElement(Ye.a,{onHide:t,show:this.state.show,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0},s.a.createElement(Ye.a.Header,{closeButton:!0},s.a.createElement(Ye.a.Title,{id:"contained-modal-title-vcenter"},"Register")),s.a.createElement(Ye.a.Body,null,s.a.createElement(E.a,{onSubmit:this.handleSubmitPasswordChange},s.a.createElement(E.a.Group,null,s.a.createElement(E.a.Label,{htmlFor:"password"},"Password"),s.a.createElement(E.a.Control,{isInvalid:i&&n.password.length<6,type:"password",name:"password",value:n.password,maxLength:"11",onChange:this.handleChange}),s.a.createElement(E.a.Control.Feedback,{type:"invalid"},0===n.password.length?"Password is required":"Password too short (min 6 chars)")),l&&s.a.createElement(vt.a,{variant:"success"},"Password has been reseated! Redirecting to login page."),o&&s.a.createElement(vt.a,{variant:"danger"},c||"Error while resetting password."),s.a.createElement(E.a.Group,null,s.a.createElement(y.a,{type:"submit",className:"btn-primary"},"Reset password"),r&&s.a.createElement("img",{alt:"loading...",className:"pl-2",src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="})))),s.a.createElement(Ye.a.Footer,null,s.a.createElement(y.a,{onClick:t},"Close")))}}]),t}(s.a.Component);var Ct=Object(B.b)(function(e){return{registering:e.registration.registering,alert:e.alert}})(St),kt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).props.dispatch(Q.logout()),a.state={user:{email:""},submitted:!1,show:!0,emailSending:!1,emailSend:!1,emailError:!1,errorMessage:""},a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a.handleSubmitForgotRequest=a.handleSubmitForgotRequest.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleChange",value:function(e){this.setState({emailError:!1});var t=e.target,a=t.name,n=t.value,s=this.state.user;this.setState({user:Object(ye.a)({},s,Object(ve.a)({},a,n))})}},{key:"handleSubmitForgotRequest",value:function(e){var t=this;e.preventDefault(),this.setState({emailSending:!0,emailError:!1,errorMessage:""}),z.a.post("".concat(k.apiUrl,"users/password/forgot"),{email:this.state.user.email}).then(function(e){t.setState({emailSend:!0,emailSending:!1})}).catch(function(e){var a="";e.response&&e.response.data&&e.response.data.errors&&(a=e.response.data.errors),t.setState({emailError:!0,emailSending:!1,errorMessage:a})})}},{key:"render",value:function(){var e=this,t=function(){e.setState({show:!1}),e.props.history.goBack()},a=this.state,n=a.user,i=a.submitted,l=a.emailSending,r=a.emailSend,o=a.emailError,c=a.errorMessage;return s.a.createElement(Ye.a,{onHide:t,show:this.state.show,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0},s.a.createElement(Ye.a.Header,{closeButton:!0},s.a.createElement(Ye.a.Title,{id:"contained-modal-title-vcenter"},"Register")),s.a.createElement(Ye.a.Body,null,s.a.createElement(E.a,{onSubmit:this.handleSubmitForgotRequest},s.a.createElement(E.a.Group,null,s.a.createElement(E.a.Label,{htmlFor:"email"},"Email"),s.a.createElement(E.a.Control,{isInvalid:i&&!n.email||"alert-danger"===alert.type&&alert.message,type:"email",name:"email",value:n.email,onChange:this.handleChange}),s.a.createElement(E.a.Control.Feedback,{type:"invalid"},alert.message?alert.message:"Email is required")),r&&s.a.createElement(vt.a,{variant:"success"},"Email with link to reset password has been sent."),o&&s.a.createElement(vt.a,{variant:"danger"},c||"Error while sending email."),s.a.createElement(E.a.Group,null,s.a.createElement(y.a,{type:"submit",className:"btn-primary"},"Reset password"),l&&s.a.createElement("img",{alt:"loading...",className:"pl-2",src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="})))),s.a.createElement(Ye.a.Footer,null,s.a.createElement(y.a,{onClick:t},"Close")))}}]),t}(s.a.Component);var Ot=Object(B.b)(function(e){return{registering:e.registration.registering,alert:e.alert}})(kt),It=a(293),Nt=k.pathName,Lt=function(e){var t=e.component,a=Object(It.a)(e,["component"]);return s.a.createElement(Et.b,Object.assign({},a,{render:function(e){return localStorage.getItem("user")?s.a.createElement(t,e):s.a.createElement(Et.a,{to:{pathname:"".concat(Nt,"login"),state:{from:e.location}}})}}))},Dt=a(178),jt=a.n(Dt),xt=a(292),Rt=k.pathName,Mt=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).handleScroll=function(){if(a.state.addOpenedIndex>=0&&!fe.isMobile){var e=a.state.films;e[a.state.addOpenedIndex].add=!1,a.setState({films:e,addOpenedIndex:-1})}a.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}})},a.handleResize=function(){a.setState({windowWidth:window.innerWidth})},a.handlePlaylistOperation=function(e){if(a.state.addOpenedIndex>=0){var t=a.state.films;t.forEach(function(e){e.add=!1}),a.setState({films:t,addOpenedIndex:-1})}a.setState({openSnackbar:!0,note:e})},a.handleClickOutside=function(e){if(a.state.addOpenedIndex>=0){var t=a.state.films;t.forEach(function(e){e.add=!1}),a.setState({films:t,addOpenedIndex:e})}},a.handleCreatePlaylistClick=function(){a.setState({addOpenedIndex:-1})},a.handleAddPlaylistButtonClick=function(e){var t=a.state.films;t[e].add=!t[e].add,a.setState({films:t,addOpenedIndex:e})},a.handleClose=function(e,t){"clickaway"!==t&&a.setState({openSnackbar:!1})},a.setRedirect=function(e,t){t?a.props.history.push({pathname:"".concat(Rt,"film/")+e,search:"?list=".concat(t)}):a.props.history.push({pathname:"".concat(Rt,"film/")+e})},a.handleRemovePlaylist=function(e,t){var n={headers:O()};z.a.delete("".concat(k.apiUrl,"playlists/").concat(e),n).then(function(e){var n=a.state.playlists;n.splice(t,1),a.setState({playlists:n,openSnackbar:!0,note:"Playlist removed successfully!"})}).catch(function(e){console.log(e)})},a.handleRemoveFilm=function(e,t){var n={headers:O()};z.a.delete("".concat(k.apiUrl,"films/").concat(e),n).then(function(e){var n=a.state.films;n.splice(t,1),a.setState({films:n,openSnackbar:!0,note:"Film removed successfully!"})}).catch(function(e){console.log(JSON.stringify(e))})},a.state={films:[],playlists:[],user:{},addOpenedIndex:-1,redirect:!1,clickedOutside:!1,error:!1,isLoading:!1,scroll:{},windowWidth:window.innerWidth,openSnackbar:!1,note:""},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize);var t={headers:O()};localStorage.getItem("user")&&z.a.get("".concat(k.apiUrl,"users/me"),t).then().catch(function(t){e.props.dispatch(Q.logout())}),this.setState({scroll:{scrollTop:document.documentElement.scrollTop,offsetHeight:document.documentElement.offsetHeight,innerHeight:window.innerHeight}}),this.setState({isLoading:!0},Object(xt.a)(jt.a.mark(function t(){var a;return jt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={headers:O()},t.next=3,z.a.get("".concat(k.apiUrl,"users/me/films"),a).then(function(t){var a=t.data;a.forEach(function(e){e.add=!1}),e.setState({films:a})}).catch(function(e){console.log(JSON.stringify(e))});case 3:return t.next=5,z.a.get("".concat(k.apiUrl,"users/me/playlists"),a).then(function(t){var a=t.data;e.setState({isLoading:!1,isLoaded:!0,playlists:a})}).catch(function(t){e.setState({error:t.message,isLoading:!1,isLoaded:!0})});case 5:case"end":return t.stop()}},t)})))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this,t=this.state.isLoading,a=this.state.scroll;return s.a.createElement(A.a,null,s.a.createElement(ee.a,{className:"mt-5"},this.state.films.map(function(t,a){var n=t.id;return s.a.createElement(A.a,{className:"mb-5 film-preview-holder playlist-remove-container",xs:6,sm:4,md:3,lg:2,key:t.id},s.a.createElement("div",{className:"embed-responsive embed-responsive-16by9 z-depth-1-half container"},s.a.createElement("img",{alt:"",className:"embed-responsive-item image",src:"".concat(k.apiUrl,"films/").concat(t.id,"/thumbnail/").concat(t.thumbnail._id,"?width=small"),onClick:function(){return e.setRedirect(n)}}),s.a.createElement(p.a,{className:"middle",icon:"play",onClick:function(){return e.setRedirect(n)}})),s.a.createElement(ee.a,{className:"m-0"},s.a.createElement(A.a,{xs:8,sm:8,className:"p-0"},s.a.createElement(ue.a,{line:2,text:t.title,id:"s-c-2",className:"mb-1 mt-1 title "})),s.a.createElement(A.a,{xs:1,sm:1,style:{height:"24px",position:"absolute",right:28},className:"playlist-remove-holder p-0 d-flex text-center justify-content-center align-items-center",onClick:function(){return e.handleRemoveFilm(t.id,a)}},s.a.createElement(p.a,{icon:"trash-alt"})),s.a.createElement(A.a,{xs:1,sm:1,className:"p-0",style:{position:"absolute",right:8}},s.a.createElement(me,{parentName:"profile",filmID:t.id,filmTitle:t.title,show:t.add,index:a,handleAddPlaylistButtonClick:e.handleAddPlaylistButtonClick,handleClick:e.handleCreatePlaylistClick,handleClickOutside:e.handleClickOutside,handlePlaylistOperation:e.handlePlaylistOperation}))),s.a.createElement("p",{className:"mb-0 mt-1 film-views"},s.a.createElement("small",null,t.views," views")))}),this.state.playlists.map(function(t,a){var n=t.films[0],i=t.id;return s.a.createElement(A.a,{className:"mb-5 playlist-remove-container",xs:6,sm:4,md:3,lg:2,key:t.id},s.a.createElement("div",{onClick:function(){return e.setRedirect(n,i)},className:"embed-responsive embed-responsive-16by9 z-depth-1-half container"},s.a.createElement("img",{alt:"",className:"embed-responsive-item image",src:"".concat(k.apiUrl,"films/").concat(n,"/thumbnail/").concat(t.thumbnail,"?width=small")}),s.a.createElement(ee.a,{className:"middle"},s.a.createElement(A.a,{xs:4,sm:4},s.a.createElement(p.a,{icon:"play"})),s.a.createElement(A.a,{xs:8,sm:8},s.a.createElement("small",{className:"font-weight-bold"},"Play all")))),s.a.createElement(ee.a,{className:"p-0 m-0"},s.a.createElement(A.a,{className:"p-0 m-0 "},s.a.createElement("p",{className:"mb-1"},s.a.createElement("small",{className:"font-weight-bolder"},t.title))),s.a.createElement(A.a,{xs:2,sm:2,className:"playlist-remove-holder m-0 p-0 text-center justify-content-center d-flex align-items-center",onClick:function(){return e.handleRemovePlaylist(t.id,a)}},s.a.createElement(p.a,{icon:"trash-alt"}))),s.a.createElement("p",{className:"mb-0 author-nick"},s.a.createElement("small",null,t.authorName)))})),(0===a.scrollTop||a.offsetHeight<=a.innerHeight)&&this.state.hasMore&&s.a.createElement(A.a,{sm:12,className:"text-center"},s.a.createElement(ne.a,{className:"button-my",variant:"contained",disabled:t,onClick:t?null:this.loadData},t?"Loading\u2026":"Click to load")),s.a.createElement(A.a,{style:{height:40},sm:12,className:"text-center"},!(0===a.scrollTop||a.offsetHeight<=a.innerHeight)&&this.state.isLoading&&s.a.createElement(te.a,{animation:"border"})),s.a.createElement(he.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.state.openSnackbar,autoHideDuration:3e3,onClose:this.handleClose,ContentProps:{"aria-describedby":"message-id"},message:s.a.createElement("span",{id:"message-id"},this.state.note)}))}}]),t}(n.Component);var Ht=Object(se.a)(function(e){return{loggedIn:e.auth.loggedIn}})(Mt);bt.b.add(yt.h,yt.g,yt.l,yt.k,yt.d,yt.f,yt.e,yt.b,yt.a,yt.c,yt.i,yt.j,yt.m);var Ut=k.pathName,Tt=function(e){function t(e){var a;Object(r.a)(this,t);var n=(a=Object(c.a)(this,Object(m.a)(t).call(this,e))).props.dispatch;return L.listen(function(e,t){n(Q.rate("CHECK_RATE")),n(C.clear())}),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(Et.c,{history:L},s.a.createElement(Et.b,{component:function(){return s.a.createElement(X,{location:L.location,history:L})}}),s.a.createElement(Et.b,{exact:!0,path:["".concat(Ut,"login"),"".concat(Ut,"film/:id/login"),"".concat(Ut,"search/login"),"".concat(Ut,"add/login"),"".concat(Ut,"playlists/login")],component:Ve}),s.a.createElement(Et.b,{exact:!0,path:["".concat(Ut,"register"),"".concat(Ut,"film/:id/register"),"".concat(Ut,"search/register"),"".concat(Ut,"add/register"),"".concat(Ut,"playlists/register")],component:Ze}),s.a.createElement(Et.b,{exact:!0,path:["".concat(Ut,"reset/:token"),"".concat(Ut,"film/:id/reset/:token"),"".concat(Ut,"search/reset/:token"),"".concat(Ut,"add/reset/:token"),"".concat(Ut,"playlists/reset/:token")],component:Ct}),s.a.createElement(Et.b,{exact:!0,path:["".concat(Ut,"forgot"),"".concat(Ut,"film/:id/forgot"),"".concat(Ut,"search/forgot"),"".concat(Ut,"add/forgot"),"".concat(Ut,"playlists/forgot")],component:Ot}),s.a.createElement(Et.d,null,s.a.createElement(Et.b,{exact:!0,path:["".concat(Ut,"film/:id"),"".concat(Ut,"film/:id/login"),"".concat(Ut,"film/:id/register"),"".concat(Ut,"film/:id/reset/:token"),"".concat(Ut,"film/:id/forgot")],component:_e}),s.a.createElement(Et.b,{exact:!0,path:["".concat(Ut),"".concat(Ut,"login"),"".concat(Ut,"register"),"".concat(Ut,"reset/:token"),"".concat(Ut,"forgot")],component:be}),s.a.createElement(Et.b,{exact:!0,path:["".concat(Ut,"search"),"".concat(Ut,"search/login"),"".concat(Ut,"search/register"),"".concat(Ut,"search/reset/:token"),"".concat(Ut,"search/forgot")],component:it}),s.a.createElement(Et.b,{exact:!0,path:["".concat(Ut,"add"),"".concat(Ut,"add/login"),"".concat(Ut,"add/register"),"".concat(Ut,"add/reset/:token"),"".concat(Ut,"add/forgot")],component:ut}),s.a.createElement(Et.b,{exact:!0,path:["".concat(Ut,"playlists"),"".concat(Ut,"playlists/login"),"".concat(Ut,"playlists/register"),"".concat(Ut,"playlists/reset/:token"),"".concat(Ut,"playlists/forgot")],component:ot}),s.a.createElement(Lt,{exact:!0,path:["".concat(Ut,"profile")],component:Ht}),s.a.createElement(Et.b,{exact:!0,path:"*",component:At}))))}}]),t}(n.Component);var Pt=Object(B.b)(function(e){return{alert:e.alert}})(Tt);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(s.a.createElement(B.a,{store:U},s.a.createElement(Pt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[295,1,2]]]);
//# sourceMappingURL=main.13fc0646.chunk.js.map